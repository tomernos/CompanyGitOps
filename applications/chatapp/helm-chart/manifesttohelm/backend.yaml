

# apiVersion: v1
# kind: Service
# metadata:
#   name: backend-api
#   labels:
#     app: backend
# spec:
#   # ClusterIP - internal only (frontend will call this)
#   type: ClusterIP
#   selector:
#     app: backend
#   ports:
#   - name: http
#     port: 5000
#     targetPort: 5000

# ---
# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   name: backend
# spec:
#   # 2 replicas for high availability
#   # Load balanced automatically by Service
#   replicas: 1
  
#   selector:
#     matchLabels:
#       app: backend
  
#   # Rolling update strategy (zero downtime deployments!)
#   # strategy:
#   #   type: RollingUpdate
#   #   rollingUpdate:
#   #     maxSurge: 1        # Can have 1 extra pod during update
#   #     maxUnavailable: 0  # Never have less than 2 pods running
  
#   template:
#     metadata:
#       labels:
#         app: backend
#     spec:
#       # Docker Hub authentication for private images
#       imagePullSecrets:
#       - name: dockerhub-secret
      
#       containers:
#       - name: backend
#         image: tomernos/connecthub-backend:1b46d09
        
#         # Always pull image (ensures latest version)
#         imagePullPolicy: Always
        
#         ports:
#         - containerPort: 5000
#           name: http
        
#         # Inject ALL ConfigMap values as environment variables
#         envFrom:
#         - configMapRef:
#             name: backend-config
        
#         # Inject specific Secret values
#         env:
#         - name: DB_PASSWORD
#           valueFrom:
#             secretKeyRef:
#               name: backend-secret
#               key: DB_PASSWORD
#         - name: SECRET_KEY
#           valueFrom:
#             secretKeyRef:
#               name: backend-secret
#               key: SECRET_KEY
#         - name: RABBITMQ_PASSWORD
#           valueFrom:
#             secretKeyRef:
#               name: backend-secret
#               key: RABBITMQ_PASSWORD
        
#         # Resource requests and limits (Kubernetes scheduling)
#         resources:
#           requests:
#             memory: "128Mi"  # Minimum memory needed
#             cpu: "100m"      # Minimum CPU (0.1 core)
#           limits:
#             memory: "256Mi"  # Maximum memory allowed
#             cpu: "200m"      # Maximum CPU (0.2 core)
        
#         # Liveness probe - is container alive?
#         # If this fails 3 times, K8s will restart the pod
#         livenessProbe:
#           httpGet:
#             path: /health
#             port: 5000
#           initialDelaySeconds: 30  # Wait 30s after start
#           periodSeconds: 10        # Check every 10s
#           timeoutSeconds: 5
#           failureThreshold: 3
        
#         # Readiness probe - is container ready to receive traffic?
#         # If this fails, K8s removes pod from Service load balancing
#         readinessProbe:
#           httpGet:
#             path: /ready
#             port: 5000
#           initialDelaySeconds: 10  # Check after 10s
#           periodSeconds: 5         # Check every 5s
#           timeoutSeconds: 3
#           failureThreshold: 3
